{"ast":null,"code":"import _asyncToGenerator from\"/Users/maidar/Desktop/projects-d/gasp/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/maidar/Desktop/projects-d/gasp/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/maidar/Desktop/projects-d/gasp/node_modules/@babel/runtime/regenerator/index.js\";import React,{useEffect,useState}from'react';import{toast}from'react-toastify';import axios from'utils/axios';import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";export default function ConfigText(_ref){var configName=_ref.configName,_ref$title=_ref.title,title=_ref$title===void 0?\"\":_ref$title;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),value=_useState2[0],setValue=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),isEditing=_useState4[0],setEditing=_useState4[1];var handleChange=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var config,changedFiles,formData,_yield$axios$post$cat,success,data,error,info;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:config={headers:{'content-type':'multipart/form-data'}};_context.next=3;return axios.delete(\"/api/config/image/\",{data:{image:value}},config).catch(function(err){return err;});case 3:changedFiles=e.target.files;formData=new FormData();Array.from(changedFiles).map(function(file,idx){formData.append('image',file);});_context.next=8;return axios.post(\"/api/config/image/\",formData,config).catch(function(err){return err;});case 8:_yield$axios$post$cat=_context.sent;success=_yield$axios$post$cat.success;data=_yield$axios$post$cat.data;error=_yield$axios$post$cat.error;info=_yield$axios$post$cat.info;if(success){setValue(data);}else{toast.error(error);}case 14:case\"end\":return _context.stop();}}},_callee);}));return function handleChange(_x){return _ref2.apply(this,arguments);};}();var getConfig=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _yield$axios$get$catc,success,data,error,_data$;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axios.get(\"/api/config/?names=\".concat(configName)).catch(function(err){return err;});case 2:_yield$axios$get$catc=_context2.sent;success=_yield$axios$get$catc.success;data=_yield$axios$get$catc.data;error=_yield$axios$get$catc.error;if(success){setValue((data===null||data===void 0?void 0:(_data$=data[0])===null||_data$===void 0?void 0:_data$.value)||\"\");}case 7:case\"end\":return _context2.stop();}}},_callee2);}));return function getConfig(){return _ref3.apply(this,arguments);};}();useEffect(function(){getConfig();},[]);var onSubmit=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var body,_yield$axios$put$catc,success,data,error,info;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:body={configs:{name:configName,value:value}};_context3.next=3;return axios.put(\"/api/config/\",body).catch(function(err){return err;});case 3:_yield$axios$put$catc=_context3.sent;success=_yield$axios$put$catc.success;data=_yield$axios$put$catc.data;error=_yield$axios$put$catc.error;info=_yield$axios$put$catc.info;if(success){toast.success(\"\".concat(title,\" \\u0437\\u0430\\u0441\\u043B\\u0430\\u0430\"));}else{toast.error(\"\".concat(title,\": \").concat(error));}case 9:case\"end\":return _context3.stop();}}},_callee3);}));return function onSubmit(){return _ref4.apply(this,arguments);};}();var handleClick=function handleClick(){var changed=!isEditing;if(!changed){onSubmit();}setEditing(changed);};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"label\",{htmlFor:configName,children:[title,\":\"]}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",multiple:false,id:configName,disabled:!isEditing,readOnly:!isEditing,onChange:handleChange}),/*#__PURE__*/_jsx(\"button\",{onClick:handleClick,children:isEditing?\"save\":\"edit\"}),/*#__PURE__*/_jsx(\"img\",{src:process.env.REACT_APP_SERVER_URL+value,alt:\"\",width:100})]});}","map":{"version":3,"sources":["/Users/maidar/Desktop/projects-d/gasp/src/pages/Admin/Pages/Config/ConfigImage.js"],"names":["React","useEffect","useState","toast","axios","ConfigText","configName","title","value","setValue","isEditing","setEditing","handleChange","e","config","headers","delete","data","image","catch","err","changedFiles","target","files","formData","FormData","Array","from","map","file","idx","append","post","success","error","info","getConfig","get","onSubmit","body","configs","name","put","handleClick","changed","process","env","REACT_APP_SERVER_URL"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react'\nimport { toast } from 'react-toastify'\n\nimport axios from 'utils/axios'\n\nexport default function ConfigText({ configName, title=\"\" }) {\n\n    const [ value, setValue ] = useState(\"\")\n    const [ isEditing, setEditing ] = useState()\n\n    const handleChange = async (e) =>\n    {\n        const config =\n        {\n            headers: { 'content-type': 'multipart/form-data' }\n        }\n\n        await axios.delete(`/api/config/image/`, { data: { image: value } }, config).catch(err => err)\n\n        const changedFiles = e.target.files\n        const formData = new FormData()\n        Array.from(changedFiles).map((file, idx) =>\n        {\n            formData.append('image', file)\n        })\n\n        const { success, data, error, info } = await axios.post(`/api/config/image/`, formData, config).catch(err => err)\n        if (success)\n        {\n            setValue(data)\n        }\n        else {\n            toast.error(error)\n        }\n    }\n\n    const getConfig = async () =>\n    {\n        const { success, data, error } = await axios.get(`/api/config/?names=${configName}`).catch(err => err)\n        if (success)\n        {\n            setValue(data?.[0]?.value || \"\")\n        }\n    }\n\n    useEffect(\n        () =>\n        {\n            getConfig()\n        },\n        []\n    )\n\n    const onSubmit = async () =>\n    {\n        const body = {\n            configs: {\n                name: configName,\n                value: value\n            }\n        }\n        const { success, data, error, info } = await axios.put(`/api/config/`, body).catch(err => err)\n        if (success)\n        {\n            toast.success(`${title} заслаа`)\n        }\n        else {\n            toast.error(`${title}: ${error}`)\n        }\n    }\n\n    const handleClick = () =>\n    {\n        const changed = !isEditing\n        if (!changed)\n        {\n            onSubmit()\n        }\n        setEditing(changed)\n    }\n\n    return (\n        <div>\n            <label htmlFor={configName}>{title}:</label>\n            <input type=\"file\" multiple={false} id={configName} disabled={!isEditing} readOnly={!isEditing} onChange={handleChange} />\n            <button onClick={handleClick}>{isEditing ? \"save\" : \"edit\"}</button>\n            <img src={process.env.REACT_APP_SERVER_URL + value} alt='' width={100}/>\n        </div>\n    )\n}\n"]},"metadata":{},"sourceType":"module"}