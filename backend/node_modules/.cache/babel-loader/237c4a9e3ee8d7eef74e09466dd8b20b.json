{"ast":null,"code":"import _defineProperty from\"/Users/maidar/Desktop/projects-d/gasp/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"/Users/maidar/Desktop/projects-d/gasp/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/Users/maidar/Desktop/projects-d/gasp/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/maidar/Desktop/projects-d/gasp/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/maidar/Desktop/projects-d/gasp/node_modules/@babel/runtime/regenerator/index.js\";import React,{useEffect,useState,useRef}from'react';import{useParams,useNavigate}from'react-router-dom';import{toast}from'react-toastify';import axios from'utils/axios';import{getImageFormUrl}from'utils';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function NewsForm(){/** form ийн утгийг хадгалах state */var _useState=useState({}),_useState2=_slicedToArray(_useState,2),formData=_useState2[0],setFormData=_useState2[1];/** author ийн жагсаалтыг хадгалах state */var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),authors=_useState4[0],setAuthors=_useState4[1];/** ангилалуудын жагсаалтыг хадгалах state */var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),categories=_useState6[0],setCategories=_useState6[1];/** оруулсан зургийг хадгалах state */var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),image=_useState8[0],setImage=_useState8[1];/** update хийж байгаа хуудас байх үед newsId байна */var _useParams=useParams(),podcastId=_useParams.podcastId;/** хуудас үсрэхэд ашиглах функц */var navigate=useNavigate();/** author уудийн жагсаалтыг авах нь */var getAuthors=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$axios$get,success,data,error,info;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get('/api/author/');case 2:_yield$axios$get=_context.sent;success=_yield$axios$get.success;data=_yield$axios$get.data;error=_yield$axios$get.error;info=_yield$axios$get.info;/** амжилттай дата ирвэл author ийг state -д оноох нь */if(success){setAuthors(data);}else{/** алдаа гарвал алдааг харуулах нь */toast(error);}case 8:case\"end\":return _context.stop();}}},_callee);}));return function getAuthors(){return _ref.apply(this,arguments);};}();/** Ангилалуудыг авах нь */var getCategories=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _yield$axios$get2,success,data,error,info;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axios.get('/api/category/');case 2:_yield$axios$get2=_context2.sent;success=_yield$axios$get2.success;data=_yield$axios$get2.data;error=_yield$axios$get2.error;info=_yield$axios$get2.info;/** амжилттай дата ирвэл ангилалийг state -д оноох нь */if(success){setCategories(data);}else{/** алдаа гарвал алдааг харуулах нь */toast.error(error);}case 8:case\"end\":return _context2.stop();}}},_callee2);}));return function getCategories(){return _ref2.apply(this,arguments);};}();/** podcast дэлгэрэнгүй авах нь */var getPodcast=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(podcastId){var _yield$axios$get3,success,data,error,_data$author,_data$category;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return axios.get(\"/api/podcast/\".concat(podcastId?podcastId+\"/\":\"\"));case 2:_yield$axios$get3=_context3.sent;success=_yield$axios$get3.success;data=_yield$axios$get3.data;error=_yield$axios$get3.error;if(success){data.author=((_data$author=data.author)===null||_data$author===void 0?void 0:_data$author._id)||\"\";data.category=data===null||data===void 0?void 0:(_data$category=data.category)===null||_data$category===void 0?void 0:_data$category._id;setFormData(data);}else{toast.error(error);}case 7:case\"end\":return _context3.stop();}}},_callee3);}));return function getPodcast(_x){return _ref3.apply(this,arguments);};}();/** анх орж ирэхэд podcast ыг дуудна */useEffect(function(){getAuthors();getCategories();/** хэрвээ id байвал podcast дэлгэрэнгүй дуудна */if(podcastId){getPodcast(podcastId);}},[]);/** өөрчлөлтийг state -д хадгалах */var handleChange=function handleChange(event,key){var value=event.target.value;setFormData(_objectSpread(_objectSpread({},formData),{},_defineProperty({},key,value)));};/** хадгалах үед back руу хүсэлт шидэж хадгалах функц */var handleSubmit=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(event){var reqFormData,config,_yield$axios$put,_success,_data,_error,_info,_yield$axios$post,success,data,error,info;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:/** submit дарахад хуудас refresh хийж байгааг болиулсан */event.preventDefault();reqFormData=new FormData();reqFormData.append('title',formData.title);reqFormData.append('clock',formData.clock);reqFormData.append('text',formData.text);reqFormData.append('category',formData.category);reqFormData.append('author',formData.author);reqFormData.append('url',formData.url);if(image){Array.from(image.target.files).map(function(file,idx){return reqFormData.append('image',file);});}config={headers:{'content-type':'multipart/form-data'}};/** update үе нь */if(!podcastId){_context4.next=20;break;}_context4.next=13;return axios.put(\"/api/podcast/\".concat(podcastId,\"/\"),reqFormData,config);case 13:_yield$axios$put=_context4.sent;_success=_yield$axios$put.success;_data=_yield$axios$put.data;_error=_yield$axios$put.error;_info=_yield$axios$put.info;if(_success){toast.success(_info);navigate('/admin/podcast/');}else{toast.error(_error);}return _context4.abrupt(\"return\");case 20:_context4.next=22;return axios.post('/api/podcast/',reqFormData,config);case 22:_yield$axios$post=_context4.sent;success=_yield$axios$post.success;data=_yield$axios$post.data;error=_yield$axios$post.error;info=_yield$axios$post.info;if(success){toast.success(info);navigate('/admin/podcast/');}else{toast.error(error);}case 28:case\"end\":return _context4.stop();}}},_callee4);}));return function handleSubmit(_x2){return _ref4.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"page-title\",children:\"Podcast \\u04AF\\u04AF\\u0441\\u0433\\u044D\\u0445\"}),/*#__PURE__*/_jsx(\"div\",{className:\"page-content\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"title\",children:\"\\u0422\\u0443\\u0445\\u0430\\u0439\\u043D podcast \\u0433\\u0430\\u0440\\u0447\\u0438\\u0433 :\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"title\",value:formData.title,onChange:function onChange(e){return handleChange(e,'title');}})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"clock\",children:\"Podcast \\u0438\\u0439\\u043D \\u0431\\u0438\\u0447\\u043B\\u044D\\u0433\\u043D\\u0438\\u0439 \\u0443\\u0440\\u0442 ms \\u044D\\u044D\\u0440 :\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",id:\"clock\",value:formData.clock,onChange:function onChange(e){return handleChange(e,'clock');}})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"text\",children:\"Podcast \\u0438\\u0439\\u043D \\u0442\\u043E\\u0432\\u0447 \\u0442\\u0430\\u0439\\u043B\\u0431\\u0430\\u0440:\"}),/*#__PURE__*/_jsx(\"textarea\",{id:\"text\",value:formData.text,onChange:function onChange(e){return handleChange(e,'text');}})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"url\",children:\"Podcast \\u0438\\u0439\\u043D \\u0445\\u043E\\u043B\\u0431\\u043E\\u043E\\u0441:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"text\",value:formData.url,onChange:function onChange(e){return handleChange(e,'url');}})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"author\",children:\"Author:\"}),/*#__PURE__*/_jsxs(\"select\",{id:\"author\",value:formData.author,onChange:function onChange(e){return handleChange(e,'author');},children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\u0421\\u043E\\u043D\\u0433\\u043E\"}),authors.map(function(author,idx){return/*#__PURE__*/_jsx(\"option\",{value:author._id,children:author.nickName},idx);})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"category\",children:\"\\u0410\\u043D\\u0433\\u0438\\u043B\\u0430\\u043B:\"}),/*#__PURE__*/_jsxs(\"select\",{id:\"category\",value:formData.category,onChange:function onChange(e){return handleChange(e,'category');},children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\u0421\\u043E\\u043D\\u0433\\u043E\"}),categories.map(function(category,idx){return/*#__PURE__*/_jsx(\"option\",{value:category._id,children:category.name},idx);})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"image\",children:\"Podcast \\u043D\\u0438\\u0439 thubmnail \\u0437\\u0443\\u0440\\u0430\\u0433:\"}),/*#__PURE__*/_jsx(\"input\",{id:\"image\",type:\"file\",onChange:setImage,multiple:false})]}),/*#__PURE__*/_jsx(\"button\",{className:\"main\",type:\"submit\",children:\"\\u0425\\u0430\\u0434\\u0433\\u0430\\u043B\\u0430\\u0445\"})]})})]});}","map":{"version":3,"sources":["/Users/maidar/Desktop/projects-d/gasp/src/pages/Admin/Pages/Podcast/form.js"],"names":["React","useEffect","useState","useRef","useParams","useNavigate","toast","axios","getImageFormUrl","NewsForm","formData","setFormData","authors","setAuthors","categories","setCategories","image","setImage","podcastId","navigate","getAuthors","get","success","data","error","info","getCategories","getPodcast","author","_id","category","handleChange","event","key","value","target","handleSubmit","preventDefault","reqFormData","FormData","append","title","clock","text","url","Array","from","files","map","file","idx","config","headers","put","post","e","nickName","name"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef } from 'react'\nimport { useParams, useNavigate } from 'react-router-dom'\nimport { toast } from 'react-toastify'\n\nimport axios from 'utils/axios'\nimport { getImageFormUrl } from 'utils'\n\nexport default function NewsForm()\n{\n    /** form ийн утгийг хадгалах state */\n    const [ formData, setFormData ] = useState({})\n    /** author ийн жагсаалтыг хадгалах state */\n    const [ authors, setAuthors ] = useState([])\n    /** ангилалуудын жагсаалтыг хадгалах state */\n    const [ categories, setCategories ] = useState([])\n    /** оруулсан зургийг хадгалах state */\n    const [ image, setImage ] = useState(null)\n    /** update хийж байгаа хуудас байх үед newsId байна */\n    const { podcastId } = useParams()\n\n    /** хуудас үсрэхэд ашиглах функц */\n    const navigate = useNavigate()\n\n    /** author уудийн жагсаалтыг авах нь */\n    const getAuthors = async () =>\n    {\n        const { success, data, error, info } = await axios.get('/api/author/')\n        /** амжилттай дата ирвэл author ийг state -д оноох нь */\n        if (success)\n        {\n            setAuthors(data)\n        }\n        else {\n            /** алдаа гарвал алдааг харуулах нь */\n            toast(error)\n        }\n    }\n\n    /** Ангилалуудыг авах нь */\n    const getCategories = async () =>\n    {\n        const { success, data, error, info } = await axios.get('/api/category/')\n        /** амжилттай дата ирвэл ангилалийг state -д оноох нь */\n        if (success)\n        {\n            setCategories(data)\n        }\n        else {\n            /** алдаа гарвал алдааг харуулах нь */\n            toast.error(error)\n        }\n    }\n\n    /** podcast дэлгэрэнгүй авах нь */\n    const getPodcast = async (podcastId) =>\n    {\n        const { success, data, error } = await axios.get(`/api/podcast/${podcastId ? podcastId + \"/\" : \"\"}`)\n        if (success)\n        {\n            data.author = data.author?._id || \"\"\n            data.category = data?.category?._id\n            setFormData(data)\n        }\n        else {\n            toast.error(error)\n        }\n    }\n\n    /** анх орж ирэхэд podcast ыг дуудна */\n    useEffect(() =>\n    {\n        getAuthors()\n        getCategories()\n        /** хэрвээ id байвал podcast дэлгэрэнгүй дуудна */\n        if (podcastId)\n        {\n            getPodcast(podcastId)\n        }\n    }, [])\n\n    /** өөрчлөлтийг state -д хадгалах */\n    const handleChange = (event, key) =>\n    {\n        const value = event.target.value\n        setFormData({ ...formData, [key]: value })\n    }\n\n    /** хадгалах үед back руу хүсэлт шидэж хадгалах функц */\n    const handleSubmit = async (event) =>\n    {\n        /** submit дарахад хуудас refresh хийж байгааг болиулсан */\n        event.preventDefault()\n\n        const reqFormData = new FormData()\n        reqFormData.append('title', formData.title)\n        reqFormData.append('clock', formData.clock)\n        reqFormData.append('text', formData.text)\n        reqFormData.append('category', formData.category)\n        reqFormData.append('author', formData.author)\n        reqFormData.append('url', formData.url)\n\n        if (image)\n        {\n            Array.from(image.target.files).map((file, idx) => reqFormData.append('image', file))\n        }\n\n        const config =\n        {\n            headers: { 'content-type': 'multipart/form-data' }\n        }\n\n        /** update үе нь */\n        if (podcastId)\n        {\n            const { success, data, error, info } = await axios.put(`/api/podcast/${podcastId}/`, reqFormData, config)\n            if (success)\n            {\n                toast.success(info)\n                navigate('/admin/podcast/')\n            }\n            else {\n                toast.error(error)\n            }\n            return\n        }\n        const { success, data, error, info } = await axios.post('/api/podcast/', reqFormData, config)\n        if (success)\n        {\n            toast.success(info)\n            navigate('/admin/podcast/')\n        }\n        else {\n            toast.error(error)\n        }\n    }\n\n    return (\n        <>\n            <h1 className={`page-title`}>Podcast үүсгэх</h1>\n            <div className={`page-content`}>\n                <form onSubmit={handleSubmit}>\n                    <div>\n                        <label htmlFor=\"title\">Тухайн podcast гарчиг :</label>\n                        <input\n                            type=\"text\"\n                            id='title'\n                            value={formData.title}\n                            onChange={(e) => handleChange(e, 'title')}\n                        />\n                    </div>\n                    <div>\n                        <label htmlFor=\"clock\">Podcast ийн бичлэгний урт ms ээр :</label>\n                        <input\n                            type=\"number\"\n                            id='clock'\n                            value={formData.clock}\n                            onChange={(e) => handleChange(e, 'clock')}\n                        />\n                    </div>\n                    <div>\n                        <label htmlFor=\"text\">Podcast ийн товч тайлбар:</label>\n                        <textarea\n                            id=\"text\"\n                            value={formData.text}\n                            onChange={(e) => handleChange(e, 'text')}\n                        >\n                        </textarea>\n                    </div>\n                    <div>\n                        <label htmlFor=\"url\">Podcast ийн холбоос:</label>\n                        <input\n                            type={\"text\"}\n                            id=\"text\"\n                            value={formData.url}\n                            onChange={(e) => handleChange(e, 'url')}\n                        />\n                    </div>\n                    <div>\n                        <label htmlFor=\"author\">Author:</label>\n                        <select\n                            id=\"author\"\n                            value={formData.author}\n                            onChange={(e) => handleChange(e, 'author')}\n                        >\n                            <option value=\"\">Сонго</option>\n                            {\n                                authors.map(\n                                    (author, idx) =>\n                                    {\n                                        return (\n                                            <option key={idx} value={author._id}>\n                                                {author.nickName}\n                                            </option>\n                                        )\n                                    }\n                                )\n                            }\n                        </select>\n                    </div>\n                    <div>\n                        <label htmlFor=\"category\">Ангилал:</label>\n                        <select\n                            id=\"category\"\n                            value={formData.category}\n                            onChange={(e) => handleChange(e, 'category')}\n                        >\n                            <option value=\"\">Сонго</option>\n                            {\n                                categories.map(\n                                    (category, idx) =>\n                                    {\n                                        return (\n                                            <option key={idx} value={category._id}>\n                                                {category.name}\n                                            </option>\n                                        )\n                                    }\n                                )\n                            }\n                        </select>\n                    </div>\n                    <div>\n                        <label htmlFor=\"image\">Podcast ний thubmnail зураг:</label>\n                        <input\n                            id=\"image\"\n                            type={\"file\"}\n                            onChange={setImage}\n                            multiple={false}\n                        >\n                        </input>\n                    </div>\n                    <button className='main' type='submit'>\n                        Хадгалах\n                    </button>\n                </form>\n            </div>\n        </>\n    )\n}\n"]},"metadata":{},"sourceType":"module"}