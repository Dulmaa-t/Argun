{"ast":null,"code":"import _defineProperty from\"/Users/maidar/Desktop/projects-d/gasp/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"/Users/maidar/Desktop/projects-d/gasp/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/Users/maidar/Desktop/projects-d/gasp/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/maidar/Desktop/projects-d/gasp/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/maidar/Desktop/projects-d/gasp/node_modules/@babel/runtime/regenerator/index.js\";import React,{useEffect,useState,useRef}from'react';import{useParams,useNavigate}from'react-router-dom';import{toast}from'react-toastify';import{Editor}from'@tinymce/tinymce-react';import axios from'utils/axios';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function NewsForm(){var _ref6;/** form ийн утгийг хадгалах state */var _useState=useState({}),_useState2=_slicedToArray(_useState,2),formData=_useState2[0],setFormData=_useState2[1];/** author ийн жагсаалтыг хадгалах state */var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),authors=_useState4[0],setAuthors=_useState4[1];/** ангилалуудын жагсаалтыг хадгалах state */var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),categories=_useState6[0],setCategories=_useState6[1];/** оруулсан зургийг хадгалах state */var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),image=_useState8[0],setImage=_useState8[1];/** Мэдээний үндсэн мэдээллийг ref хийж хариуг нь авах нь */var editorRef=useRef(null);/** update хийж байгаа хуудас байх үед newsId байна */var _useParams=useParams(),newsId=_useParams.newsId;/** хуудас үсрэхэд ашиглах функц */var navigate=useNavigate();/** author уудийн жагсаалтыг авах нь */var getAuthors=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$axios$get,success,data,error,info;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get('/api/author/');case 2:_yield$axios$get=_context.sent;success=_yield$axios$get.success;data=_yield$axios$get.data;error=_yield$axios$get.error;info=_yield$axios$get.info;/** амжилттай дата ирвэл author ийг state -д оноох нь */if(success){setAuthors(data);}else{/** алдаа гарвал алдааг харуулах нь */toast(error);}case 8:case\"end\":return _context.stop();}}},_callee);}));return function getAuthors(){return _ref.apply(this,arguments);};}();/** Ангилалуудыг авах нь */var getCategories=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _yield$axios$get2,success,data,error,info;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axios.get('/api/category/');case 2:_yield$axios$get2=_context2.sent;success=_yield$axios$get2.success;data=_yield$axios$get2.data;error=_yield$axios$get2.error;info=_yield$axios$get2.info;/** амжилттай дата ирвэл ангилалийг state -д оноох нь */if(success){setCategories(data);}else{/** алдаа гарвал алдааг харуулах нь */toast.error(error);}case 8:case\"end\":return _context2.stop();}}},_callee2);}));return function getCategories(){return _ref2.apply(this,arguments);};}();/** мэдээний дэлгэрэнгүй авах нь */var getNews=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(newsId){var _yield$axios$get3,success,data,error,_data$author;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return axios.get(\"/api/news/\".concat(newsId,\"/\"));case 2:_yield$axios$get3=_context3.sent;success=_yield$axios$get3.success;data=_yield$axios$get3.data;error=_yield$axios$get3.error;if(success){data.author=((_data$author=data.author)===null||_data$author===void 0?void 0:_data$author._id)||\"\";setFormData(data);}else{toast.error(error);}case 7:case\"end\":return _context3.stop();}}},_callee3);}));return function getNews(_x){return _ref3.apply(this,arguments);};}();/** анх орж ирэхэд author ыг дуудна */useEffect(function(){getAuthors();getCategories();/** хэрвээ id байвал мэдээний дэлгэрэнгүй дуудна */if(newsId){getNews(newsId);}},[]);/** өөрчлөлтийг state -д хадгалах */var handleChange=function handleChange(event,key){var value=event.target.value;setFormData(_objectSpread(_objectSpread({},formData),{},_defineProperty({},key,value)));};/** Зураг оруулахад ажиллах функц */var uploadImageCallBack=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(blobInfo,success,failure,progress){var file,formData,config,_yield$axios$post$cat,rSuccess,data,error,info;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:// Сонгогдсон зургийг авах\nfile=blobInfo.blob();formData=new FormData();formData.append('image',file);config={headers:{'content-type':'multipart/form-data'}};_context4.next=6;return axios.post(\"/api/config/image/\",formData,config).catch(function(err){return err;});case 6:_yield$axios$post$cat=_context4.sent;rSuccess=_yield$axios$post$cat.success;data=_yield$axios$post$cat.data;error=_yield$axios$post$cat.error;info=_yield$axios$post$cat.info;rSuccess?success(process.env.REACT_APP_SERVER_URL+data):failure();case 12:case\"end\":return _context4.stop();}}},_callee4);}));return function uploadImageCallBack(_x2,_x3,_x4,_x5){return _ref4.apply(this,arguments);};}();/** хадгалах үед back руу хүсэлт шидэж хадгалах функц */var handleSubmit=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(event){var news,reqFormData,config,_yield$axios$put,_success,_data,_error,_info,_yield$axios$post,success,data,error,info;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:/** submit дарахад хуудас refresh хийж байгааг болиулсан */event.preventDefault();/** үндсэн мэдээний дэлгэрэнгүй мэдээллийг html ээр авсан нь */news=editorRef.current.getContent();reqFormData=new FormData();reqFormData.append('title',formData.title);reqFormData.append('text',formData.text);reqFormData.append('author',formData.author);reqFormData.append('category',formData.category);reqFormData.append('news',news);if(image){Array.from(image.target.files).map(function(file,idx){return reqFormData.append('image',file);});}config={headers:{'content-type':'multipart/form-data'}};/** update үе нь */if(!newsId){_context5.next=20;break;}_context5.next=13;return axios.put(\"/api/news/\".concat(newsId,\"/\"),reqFormData,config);case 13:_yield$axios$put=_context5.sent;_success=_yield$axios$put.success;_data=_yield$axios$put.data;_error=_yield$axios$put.error;_info=_yield$axios$put.info;if(_success){toast.success(_info);navigate('/admin/news/');}else{toast.error(_error);}return _context5.abrupt(\"return\");case 20:_context5.next=22;return axios.post('/api/news/',reqFormData,config);case 22:_yield$axios$post=_context5.sent;success=_yield$axios$post.success;data=_yield$axios$post.data;error=_yield$axios$post.error;info=_yield$axios$post.info;if(success){toast.success(info);navigate('/admin/news/');}else{toast.error(error);}case 28:case\"end\":return _context5.stop();}}},_callee5);}));return function handleSubmit(_x6){return _ref5.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"page-title\",children:\"\\u041C\\u044D\\u0434\\u044D\\u044D \\u04AF\\u04AF\\u0441\\u0433\\u044D\\u0445\"}),/*#__PURE__*/_jsx(\"div\",{className:\"page-content\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"title\",children:\"\\u0413\\u0430\\u0440\\u0447\\u0438\\u0433:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"title\",value:formData.title,onChange:function onChange(e){return handleChange(e,'title');}})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"author\",children:\"Author:\"}),/*#__PURE__*/_jsxs(\"select\",{id:\"author\",value:formData.author,onChange:function onChange(e){return handleChange(e,'author');},children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\u0421\\u043E\\u043D\\u0433\\u043E\"}),authors.map(function(author,idx){return/*#__PURE__*/_jsx(\"option\",{value:author._id,children:author.nickName},idx);})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"text\",children:\"\\u0422\\u0430\\u0439\\u043B\\u0431\\u0430\\u0440:\"}),/*#__PURE__*/_jsx(\"textarea\",{id:\"text\",value:formData.text,onChange:function onChange(e){return handleChange(e,'text');}})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"image\",children:\"\\u0417\\u0443\\u0440\\u0430\\u0433:\"}),/*#__PURE__*/_jsx(\"input\",{id:\"image\",type:\"file\",onChange:setImage,multiple:false})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"category\",children:\"\\u0410\\u043D\\u0433\\u0438\\u043B\\u0430\\u043B:\"}),/*#__PURE__*/_jsxs(\"select\",{id:\"category\",value:formData.category,onChange:function onChange(e){return handleChange(e,'category');},children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\u0421\\u043E\\u043D\\u0433\\u043E\"}),categories.map(function(category,idx){return/*#__PURE__*/_jsx(\"option\",{value:category._id,children:category.name},idx);})]})]}),/*#__PURE__*/_jsx(Editor,{onInit:function onInit(evt,editor){return editorRef.current=editor;},initialValue:\"<p>This is the initial content of the editor.</p>\",init:(_ref6={height:500,menubar:true,plugins:'image | preview',content_style:'body { font-family:Helvetica,Arial,sans-serif; font-size:14px }'},_defineProperty(_ref6,\"plugins\",\"casechange advcode advlist lists spellchecker formatpainter autoresize visualblocks tinydrive image link media imagetools wordcount code\"),_defineProperty(_ref6,\"toolbar\",[\"bold italic underline | forecolor | formatselect | alignleft aligncenter alignright | bullist numlist\",\"cut copy paste formatpainter removeformat | casechange visualblocks | spellchecker | link image media | code\"]),_defineProperty(_ref6,\"images_upload_handler\",uploadImageCallBack),_defineProperty(_ref6,\"image_title\",true),_defineProperty(_ref6,\"image_advtab\",true),_defineProperty(_ref6,\"importcss_append\",true),_ref6)}),/*#__PURE__*/_jsx(\"button\",{className:\"main\",type:\"submit\",children:\"\\u0425\\u0430\\u0434\\u0433\\u0430\\u043B\\u0430\\u0445\"})]})})]});}","map":{"version":3,"sources":["/Users/maidar/Desktop/projects-d/gasp/src/pages/Admin/Pages/News/form.js"],"names":["React","useEffect","useState","useRef","useParams","useNavigate","toast","Editor","axios","NewsForm","formData","setFormData","authors","setAuthors","categories","setCategories","image","setImage","editorRef","newsId","navigate","getAuthors","get","success","data","error","info","getCategories","getNews","author","_id","handleChange","event","key","value","target","uploadImageCallBack","blobInfo","failure","progress","file","blob","FormData","append","config","headers","post","catch","err","rSuccess","process","env","REACT_APP_SERVER_URL","handleSubmit","preventDefault","news","current","getContent","reqFormData","title","text","category","Array","from","files","map","idx","put","e","nickName","name","evt","editor","height","menubar","plugins","content_style"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef } from 'react'\nimport { useParams, useNavigate } from 'react-router-dom'\nimport { toast } from 'react-toastify'\n\nimport { Editor } from '@tinymce/tinymce-react';\n\nimport axios from 'utils/axios'\n\nexport default function NewsForm()\n{\n    /** form ийн утгийг хадгалах state */\n    const [ formData, setFormData ] = useState({})\n    /** author ийн жагсаалтыг хадгалах state */\n    const [ authors, setAuthors ] = useState([])\n    /** ангилалуудын жагсаалтыг хадгалах state */\n    const [ categories, setCategories ] = useState([])\n    /** оруулсан зургийг хадгалах state */\n    const [ image, setImage ] = useState(null)\n\n    /** Мэдээний үндсэн мэдээллийг ref хийж хариуг нь авах нь */\n    const editorRef = useRef(null);\n\n    /** update хийж байгаа хуудас байх үед newsId байна */\n    const { newsId } = useParams()\n\n    /** хуудас үсрэхэд ашиглах функц */\n    const navigate = useNavigate()\n\n    /** author уудийн жагсаалтыг авах нь */\n    const getAuthors = async () =>\n    {\n        const { success, data, error, info } = await axios.get('/api/author/')\n        /** амжилттай дата ирвэл author ийг state -д оноох нь */\n        if (success)\n        {\n            setAuthors(data)\n        }\n        else {\n            /** алдаа гарвал алдааг харуулах нь */\n            toast(error)\n        }\n    }\n\n    /** Ангилалуудыг авах нь */\n    const getCategories = async () =>\n    {\n        const { success, data, error, info } = await axios.get('/api/category/')\n        /** амжилттай дата ирвэл ангилалийг state -д оноох нь */\n        if (success)\n        {\n            setCategories(data)\n        }\n        else {\n            /** алдаа гарвал алдааг харуулах нь */\n            toast.error(error)\n        }\n    }\n\n    /** мэдээний дэлгэрэнгүй авах нь */\n    const getNews = async (newsId) =>\n    {\n        const { success, data, error } = await axios.get(`/api/news/${newsId}/`)\n        if (success)\n        {\n            data.author = data.author?._id || \"\"\n            setFormData(data)\n        }\n        else {\n            toast.error(error)\n        }\n    }\n\n    /** анх орж ирэхэд author ыг дуудна */\n    useEffect(() =>\n    {\n        getAuthors()\n        getCategories()\n        /** хэрвээ id байвал мэдээний дэлгэрэнгүй дуудна */\n        if (newsId)\n        {\n            getNews(newsId)\n        }\n    }, [])\n\n    /** өөрчлөлтийг state -д хадгалах */\n    const handleChange = (event, key) =>\n    {\n        const value = event.target.value\n        setFormData({ ...formData, [key]: value })\n    }\n\n    /** Зураг оруулахад ажиллах функц */\n    const uploadImageCallBack = async (blobInfo, success, failure, progress) =>\n    {\n        // Сонгогдсон зургийг авах\n        const file = blobInfo.blob()\n\n        const formData = new FormData()\n        formData.append('image', file)\n\n        const config =\n        {\n            headers: { 'content-type': 'multipart/form-data' }\n        }\n        const { success: rSuccess, data, error, info } = await axios.post(`/api/config/image/`, formData, config).catch(err => err)\n        rSuccess\n        ?\n            success(process.env.REACT_APP_SERVER_URL + data)\n        :\n            failure()\n    }\n\n    /** хадгалах үед back руу хүсэлт шидэж хадгалах функц */\n    const handleSubmit = async (event) =>\n    {\n        /** submit дарахад хуудас refresh хийж байгааг болиулсан */\n        event.preventDefault()\n\n        /** үндсэн мэдээний дэлгэрэнгүй мэдээллийг html ээр авсан нь */\n        const news = editorRef.current.getContent()\n\n        const reqFormData = new FormData()\n        reqFormData.append('title', formData.title)\n        reqFormData.append('text', formData.text)\n        reqFormData.append('author', formData.author)\n        reqFormData.append('category', formData.category)\n        reqFormData.append('news', news)\n\n        if (image)\n        {\n            Array.from(image.target.files).map((file, idx) => reqFormData.append('image', file))\n        }\n\n        const config =\n        {\n            headers: { 'content-type': 'multipart/form-data' }\n        }\n\n        /** update үе нь */\n        if (newsId)\n        {\n            const { success, data, error, info } = await axios.put(`/api/news/${newsId}/`, reqFormData, config)\n            if (success)\n            {\n                toast.success(info)\n                navigate('/admin/news/')\n            }\n            else {\n                toast.error(error)\n            }\n            return\n        }\n        const { success, data, error, info } = await axios.post('/api/news/', reqFormData, config)\n        if (success)\n        {\n            toast.success(info)\n            navigate('/admin/news/')\n        }\n        else {\n            toast.error(error)\n        }\n    }\n\n    return (\n        <>\n            <h1 className={`page-title`}>Мэдээ үүсгэх</h1>\n            <div className={`page-content`}>\n                <form onSubmit={handleSubmit}>\n                    <div>\n                        <label htmlFor=\"title\">Гарчиг:</label>\n                        <input\n                            type=\"text\"\n                            id='title'\n                            value={formData.title}\n                            onChange={(e) => handleChange(e, 'title')}\n                        />\n                    </div>\n                    <div>\n                        <label htmlFor=\"author\">Author:</label>\n                        <select\n                            id=\"author\"\n                            value={formData.author}\n                            onChange={(e) => handleChange(e, 'author')}\n                        >\n                            <option value=\"\">Сонго</option>\n                            {\n                                authors.map(\n                                    (author, idx) =>\n                                    {\n                                        return (\n                                            <option key={idx} value={author._id}>\n                                                {author.nickName}\n                                            </option>\n                                        )\n                                    }\n                                )\n                            }\n                        </select>\n                    </div>\n                    <div>\n                        <label htmlFor=\"text\">Тайлбар:</label>\n                        <textarea\n                            id=\"text\"\n                            value={formData.text}\n                            onChange={(e) => handleChange(e, 'text')}\n                        >\n                        </textarea>\n                    </div>\n                    <div>\n                        <label htmlFor=\"image\">Зураг:</label>\n                        <input\n                            id=\"image\"\n                            type={\"file\"}\n                            onChange={setImage}\n                            multiple={false}\n                        >\n                        </input>\n                    </div>\n                    <div>\n                        <label htmlFor=\"category\">Ангилал:</label>\n                        <select\n                            id=\"category\"\n                            value={formData.category}\n                            onChange={(e) => handleChange(e, 'category')}\n                        >\n                            <option value=\"\">Сонго</option>\n                            {\n                                categories.map(\n                                    (category, idx) =>\n                                    {\n                                        return (\n                                            <option key={idx} value={category._id}>\n                                                {category.name}\n                                            </option>\n                                        )\n                                    }\n                                )\n                            }\n                        </select>\n                    </div>\n                    <Editor\n                        onInit={(evt, editor) => editorRef.current = editor}\n                        initialValue=\"<p>This is the initial content of the editor.</p>\"\n                        init={{\n                            height: 500,\n                            menubar: true,\n                            plugins: 'image | preview',\n                            content_style: 'body { font-family:Helvetica,Arial,sans-serif; font-size:14px }',\n                            plugins: \"casechange advcode advlist lists spellchecker formatpainter autoresize visualblocks tinydrive image link media imagetools wordcount code\",\n                            toolbar: [\n                                \"bold italic underline | forecolor | formatselect | alignleft aligncenter alignright | bullist numlist\",\n                                \"cut copy paste formatpainter removeformat | casechange visualblocks | spellchecker | link image media | code\"\n                            ],\n                            images_upload_handler: uploadImageCallBack,\n                            image_title: true,\n                            image_advtab: true,\n                            importcss_append: true,\n                        }}\n                    />\n                    <button className='main' type='submit'>\n                        Хадгалах\n                    </button>\n                </form>\n            </div>\n        </>\n    )\n}\n"]},"metadata":{},"sourceType":"module"}